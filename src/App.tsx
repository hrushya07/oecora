// const XMLResponse = `
// <mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36" version="28.1.2">
//   <diagram id="07fea595-8f29-1299-0266-81d95cde20df" name="Page-1">
//     <mxGraphModel dx="1214" dy="867" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" background="#ffffff" math="0" shadow="0">
//       <root>
//         <mxCell id="0" />
//         <mxCell id="1" parent="0" />
//         <mxCell id="eHIFP4p37Z23MNbaOak_-313" value="&lt;font color=&quot;#23497d&quot;&gt;Inside Sales Rep&lt;/font&gt;" style="swimlane;whiteSpace=wrap;fillColor=none;swimlaneFillColor=#BAC8D3;fontColor=#2F5B7C;fontFamily=Tahoma;html=1;strokeColor=none;opacity=50;" vertex="1" parent="1">
//           <mxGeometry x="250" y="210" width="160" height="650" as="geometry">
//             <mxRectangle x="20" y="20" width="80" height="23" as="alternateBounds" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-314" value="Customer Management" style="whiteSpace=wrap;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;plain-purple;strokeColor=none;fillColor=#2f5b7c;gradientColor=none;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-313">
//           <mxGeometry x="20" y="60" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-315" value="Credit Management" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-313">
//           <mxGeometry x="20" y="375" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-316" value="Price Management" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-313">
//           <mxGeometry x="20" y="485" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-317" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="eHIFP4p37Z23MNbaOak_-313" source="eHIFP4p37Z23MNbaOak_-315" target="eHIFP4p37Z23MNbaOak_-316">
//           <mxGeometry width="100" height="100" relative="1" as="geometry">
//             <mxPoint x="170" y="397.5" as="sourcePoint" />
//             <mxPoint x="270" y="472.5" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-318" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="eHIFP4p37Z23MNbaOak_-313" source="eHIFP4p37Z23MNbaOak_-314" target="eHIFP4p37Z23MNbaOak_-315">
//           <mxGeometry width="100" height="100" relative="1" as="geometry">
//             <mxPoint x="160" y="110" as="sourcePoint" />
//             <mxPoint x="260" y="185" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-319" value="&lt;font color=&quot;#23497d&quot;&gt;Inside Sales Manager&lt;/font&gt;" style="swimlane;whiteSpace=wrap;fillColor=none;swimlaneFillColor=#BAC8D3;fontColor=#2F5B7C;fontFamily=Tahoma;html=1;strokeColor=none;opacity=25;" vertex="1" parent="1">
//           <mxGeometry x="1050" y="210" width="160" height="650" as="geometry">
//             <mxRectangle x="20" y="20" width="80" height="23" as="alternateBounds" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-320" value="Sales Contract" style="shape=document;whiteSpace=wrap;verticalAlign=middle;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-319">
//           <mxGeometry x="20" y="50" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-321" value="Bills" style="shape=document;whiteSpace=wrap;verticalAlign=middle;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-319">
//           <mxGeometry x="20" y="530" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-322" value="Cost Allocation" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-319">
//           <mxGeometry x="20" y="305" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-323" value="&lt;font color=&quot;#23497d&quot;&gt;VP Sales&lt;/font&gt;" style="swimlane;whiteSpace=wrap;fillColor=none;swimlaneFillColor=#BAC8D3;fontColor=#2F5B7C;fontFamily=Tahoma;html=1;strokeColor=none;opacity=50;" vertex="1" parent="1">
//           <mxGeometry x="890" y="210" width="160" height="650" as="geometry">
//             <mxRectangle x="20" y="20" width="80" height="23" as="alternateBounds" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-324" value="Outbound Accounting" style="whiteSpace=wrap;fillColor=#2f5b7c;strokeColor=none;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-323">
//           <mxGeometry x="20" y="160" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-325" value="Account Processing" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-323">
//           <mxGeometry x="20" y="420" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-326" value="&lt;font color=&quot;#23497d&quot;&gt;Sales Admin&lt;/font&gt;" style="swimlane;whiteSpace=wrap;fillColor=none;swimlaneFillColor=#BAC8D3;fontColor=#2F5B7C;fontFamily=Tahoma;html=1;strokeColor=none;opacity=25;" vertex="1" parent="1">
//           <mxGeometry x="410" y="210" width="160" height="650" as="geometry">
//             <mxRectangle x="20" y="20" width="80" height="23" as="alternateBounds" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-327" value="Material Requirements Planning Operation" style="whiteSpace=wrap;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;plain-purple;strokeColor=none;fillColor=#2f5b7c;gradientColor=none;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-326">
//           <mxGeometry x="20" y="165" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-328" value="&lt;font color=&quot;#ffffff&quot;&gt;Facilities Procurement&lt;br&gt;Application&lt;/font&gt;&lt;br&gt; " style="shape=document;whiteSpace=wrap;verticalAlign=middle;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-326">
//           <mxGeometry x="20" y="265" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-329" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="eHIFP4p37Z23MNbaOak_-326" source="eHIFP4p37Z23MNbaOak_-327" target="eHIFP4p37Z23MNbaOak_-328">
//           <mxGeometry width="100" height="100" relative="1" as="geometry">
//             <mxPoint x="-10" y="100" as="sourcePoint" />
//             <mxPoint x="90" y="175" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-330" value="&lt;font color=&quot;#23497d&quot;&gt;Sales Representative&lt;/font&gt;" style="swimlane;whiteSpace=wrap;fillColor=none;swimlaneFillColor=#BAC8D3;fontColor=#2F5B7C;fontFamily=Tahoma;html=1;strokeColor=none;opacity=50;" vertex="1" parent="1">
//           <mxGeometry x="570" y="210" width="160" height="650" as="geometry">
//             <mxRectangle x="20" y="20" width="80" height="23" as="alternateBounds" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-331" value="Product Quotations" style="shape=document;whiteSpace=wrap;verticalAlign=middle;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-330">
//           <mxGeometry x="20" y="50" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-332" value="Orders" style="shape=document;whiteSpace=wrap;verticalAlign=middle;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-330">
//           <mxGeometry x="20" y="225" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-333" value="Product Delivery Notification" style="shape=document;whiteSpace=wrap;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;verticalAlign=middle;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-330">
//           <mxGeometry x="20" y="400" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-334" value="Invoice" style="shape=document;whiteSpace=wrap;verticalAlign=middle;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-330">
//           <mxGeometry x="20" y="520" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-335" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="eHIFP4p37Z23MNbaOak_-330" source="eHIFP4p37Z23MNbaOak_-333" target="eHIFP4p37Z23MNbaOak_-334">
//           <mxGeometry width="100" height="100" relative="1" as="geometry">
//             <mxPoint x="-80" y="375" as="sourcePoint" />
//             <mxPoint x="60" y="490" as="targetPoint" />
//             <Array as="points">
//               <mxPoint x="53" y="501" />
//               <mxPoint x="53" y="501" />
//             </Array>
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-336" value="&lt;font color=&quot;#23497d&quot;&gt;Sales Manager&lt;/font&gt;" style="swimlane;whiteSpace=wrap;fillColor=none;swimlaneFillColor=#BAC8D3;fontColor=#2F5B7C;fontFamily=Tahoma;html=1;strokeColor=none;opacity=25;" vertex="1" parent="1">
//           <mxGeometry x="730" y="210" width="160" height="650" as="geometry">
//             <mxRectangle x="20" y="20" width="80" height="23" as="alternateBounds" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-337" value="Inventory Control" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-336">
//           <mxGeometry x="20" y="160" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-338" value="Product Delivery" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-336">
//           <mxGeometry x="20" y="315" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-339" value="Director" style="swimlane;whiteSpace=wrap;fillColor=none;swimlaneFillColor=#BAC8D3;fontColor=#2F5B7C;fontFamily=Tahoma;html=1;strokeColor=none;opacity=50;" vertex="1" parent="1">
//           <mxGeometry x="1210" y="210" width="160" height="650" as="geometry">
//             <mxRectangle x="20" y="20" width="80" height="23" as="alternateBounds" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-340" value="Outbounding Management" style="shape=document;whiteSpace=wrap;verticalAlign=middle;strokeColor=none;fillColor=#12aab5;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;spacingBottom=22;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-339">
//           <mxGeometry x="20" y="130" width="120" height="80" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-341" value="Resources Allocation" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-339">
//           <mxGeometry x="20" y="255" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-342" value="Long Term Strategy" style="whiteSpace=wrap;strokeColor=none;fillColor=#2f5b7c;shadow=0;fontColor=#FFFFFF;fontFamily=Helvetica;fontStyle=0;html=1;fontSize=12;spacing=6;verticalAlign=middle;" vertex="1" parent="eHIFP4p37Z23MNbaOak_-339">
//           <mxGeometry x="20" y="400" width="120" height="60" as="geometry" />
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-343" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="eHIFP4p37Z23MNbaOak_-339" source="eHIFP4p37Z23MNbaOak_-341" target="eHIFP4p37Z23MNbaOak_-342">
//           <mxGeometry width="100" height="100" relative="1" as="geometry">
//             <mxPoint x="30" y="570" as="sourcePoint" />
//             <mxPoint x="130" y="470" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-344" value="" style="edgeStyle=segmentEdgeStyle;entryX=0.25;entryY=0;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="eHIFP4p37Z23MNbaOak_-339" source="eHIFP4p37Z23MNbaOak_-340" target="eHIFP4p37Z23MNbaOak_-341">
//           <mxGeometry width="100" height="100" relative="1" as="geometry">
//             <mxPoint x="-120" y="260" as="sourcePoint" />
//             <mxPoint x="-20" y="160" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-345" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-314" target="eHIFP4p37Z23MNbaOak_-327">
//           <mxGeometry x="164.5" y="178.5" width="100" height="100" as="geometry">
//             <mxPoint x="450" y="370" as="sourcePoint" />
//             <mxPoint x="550" y="270" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-346" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-328" target="eHIFP4p37Z23MNbaOak_-315">
//           <mxGeometry x="164.5" y="433.5" width="100" height="100" as="geometry">
//             <mxPoint x="500" y="445" as="sourcePoint" />
//             <mxPoint x="500" y="485" as="targetPoint" />
//             <Array as="points">
//               <mxPoint x="460" y="615" />
//             </Array>
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-347" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-314" target="eHIFP4p37Z23MNbaOak_-331">
//           <mxGeometry x="164.5" y="178.5" width="100" height="100" as="geometry">
//             <mxPoint x="400" y="310" as="sourcePoint" />
//             <mxPoint x="500" y="385" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-348" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-328" target="eHIFP4p37Z23MNbaOak_-333">
//           <mxGeometry x="234.5" y="433.5" width="100" height="100" as="geometry">
//             <mxPoint x="610" y="940" as="sourcePoint" />
//             <mxPoint x="710" y="840" as="targetPoint" />
//             <Array as="points">
//               <mxPoint x="460" y="650" />
//             </Array>
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-349" value="" style="edgeStyle=elbowEdgeStyle;elbow=vertical;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-334" target="eHIFP4p37Z23MNbaOak_-321">
//           <mxGeometry x="484.5" y="623.5" width="100" height="100" as="geometry">
//             <mxPoint x="770" y="740" as="sourcePoint" />
//             <mxPoint x="870" y="640" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-350" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-327" target="eHIFP4p37Z23MNbaOak_-332">
//           <mxGeometry x="324.5" y="283.5" width="100" height="100" as="geometry">
//             <mxPoint x="680" y="420" as="sourcePoint" />
//             <mxPoint x="780" y="320" as="targetPoint" />
//             <Array as="points" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-351" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-331" target="eHIFP4p37Z23MNbaOak_-337">
//           <mxGeometry x="484.5" y="178.5" width="100" height="100" as="geometry">
//             <mxPoint x="670" y="370" as="sourcePoint" />
//             <mxPoint x="770" y="270" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-352" value="" style="edgeStyle=none;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-337" target="eHIFP4p37Z23MNbaOak_-324">
//           <mxGeometry x="644.5" y="278.5" width="100" height="100" as="geometry">
//             <mxPoint x="910" y="580" as="sourcePoint" />
//             <mxPoint x="1010" y="480" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-353" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-332" target="eHIFP4p37Z23MNbaOak_-338">
//           <mxGeometry x="404.5" y="393.5" width="100" height="100" as="geometry">
//             <mxPoint x="750" y="610" as="sourcePoint" />
//             <mxPoint x="850" y="510" as="targetPoint" />
//             <Array as="points">
//               <mxPoint x="630" y="560" />
//             </Array>
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-354" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-338" target="eHIFP4p37Z23MNbaOak_-324">
//           <mxGeometry x="644.5" y="308.5" width="100" height="100" as="geometry">
//             <mxPoint x="870" y="560" as="sourcePoint" />
//             <mxPoint x="970" y="460" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-355" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-338" target="eHIFP4p37Z23MNbaOak_-325">
//           <mxGeometry x="644.5" y="433.5" width="100" height="100" as="geometry">
//             <mxPoint x="740" y="710" as="sourcePoint" />
//             <mxPoint x="840" y="610" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-356" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-324" target="eHIFP4p37Z23MNbaOak_-320">
//           <mxGeometry x="744.5" y="178.5" width="100" height="100" as="geometry">
//             <mxPoint x="1090" y="500" as="sourcePoint" />
//             <mxPoint x="1190" y="400" as="targetPoint" />
//             <Array as="points">
//               <mxPoint x="970" y="300" />
//             </Array>
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-357" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-324" target="eHIFP4p37Z23MNbaOak_-322">
//           <mxGeometry x="804.5" y="278.5" width="100" height="100" as="geometry">
//             <mxPoint x="1080" y="510" as="sourcePoint" />
//             <mxPoint x="1180" y="410" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-358" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-325" target="eHIFP4p37Z23MNbaOak_-321">
//           <mxGeometry x="804.5" y="538.5" width="100" height="100" as="geometry">
//             <mxPoint x="1110" y="700" as="sourcePoint" />
//             <mxPoint x="1210" y="600" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-359" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#2F5B7C;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-322" target="eHIFP4p37Z23MNbaOak_-342">
//           <mxGeometry x="964.5" y="423.5" width="100" height="100" as="geometry">
//             <mxPoint x="1320" y="620" as="sourcePoint" />
//             <mxPoint x="1420" y="520" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//         <mxCell id="eHIFP4p37Z23MNbaOak_-360" value="" style="edgeStyle=segmentEdgeStyle;strokeColor=#12AAB5;strokeWidth=3;html=1;endArrow=block;endFill=1;" edge="1" parent="1" source="eHIFP4p37Z23MNbaOak_-320" target="eHIFP4p37Z23MNbaOak_-340">
//           <mxGeometry x="964.5" y="178.5" width="100" height="100" as="geometry">
//             <mxPoint x="1080" y="470" as="sourcePoint" />
//             <mxPoint x="1180" y="370" as="targetPoint" />
//           </mxGeometry>
//         </mxCell>
//       </root>
//     </mxGraphModel>
//   </diagram>
// </mxfile>
// `


import React, { useEffect, useRef, useState } from "react";
import { BrowserRouter as Router, Routes, Route, Link, useLocation } from 'react-router-dom';
import { HiHome, HiChatAlt2, HiColorSwatch, HiX } from 'react-icons/hi';
import { IoSend } from "react-icons/io5";
import { FiPaperclip } from "react-icons/fi";
import DrawioChart from "./DrawioChart";
import Canva from "./Canva";

const Home = () => (
    <div className="flex flex-col h-[calc(100vh-3rem)] bg-white">
        <main className="flex-1 overflow-y-auto px-4 py-6 bg-white">
            <div className="mx-auto max-w-4xl space-y-4">
                <div className="text-center py-12">
                    <div className="flex justify-center mb-6">
                        <div className="w-24 h-24 bg-black rounded-full flex items-center justify-center">
                            <span className="text-white text-4xl font-bold">O</span>
                        </div>
                    </div>
                    <h1 className="text-5xl font-bold text-black mb-4">Oecora</h1>
                    <p className="text-xl text-gray-600 max-w-2xl mx-auto">
                        This is dummy sub heading for the home page.
                    </p>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mt-12">
                    <Link to="/chat" className="card bg-white border border-gray-200 shadow-lg p-8 cursor-pointer">
                        <div className="flex items-center mb-4">
                            <div className="w-12 h-12 bg-black rounded-lg flex items-center justify-center mr-4">
                                <HiChatAlt2 className="h-6 w-6 text-white" />
                            </div>
                            <h3 className="text-xl font-semibold text-black">Chat</h3>
                        </div>
                        <p className="text-gray-700">
                            AI chatbot for your queries.
                        </p>
                    </Link>
                    
                    <Link to="/canvas" className="card bg-white border border-gray-200 shadow-lg p-8 cursor-pointer">
                        <div className="flex items-center mb-4">
                            <div className="w-12 h-12 bg-black rounded-lg flex items-center justify-center mr-4">
                                <HiColorSwatch className="h-6 w-6 text-white" />
                            </div>
                            <h3 className="text-xl font-semibold text-black">Canvas</h3>
                        </div>
                        <p className="text-gray-700">
                            Create and share your own canvas.
                        </p>
                    </Link>
                </div>
            </div>
        </main>
    </div>

);


interface ChatApiResponse {
    type: 'question' | 'document'
    session_id: string;
    answer?: string;
    outputXml?: string;
}

const Chat = () => {
    const USER = 'user' as const;
    const BOT = 'bot' as const;
    
    type Sender = typeof USER | typeof BOT;
    
    type Message = {
        sender: Sender;
        text: string;
        xmlOutput?: string;
        fileName?: string;
    };

    const [messages, setMessages] = useState<Array<Message>>([
        { sender: BOT, text: 'Hello! How can I help you today?', xmlOutput: '' }
    ]);
    const [input, setInput] = useState('');
    const [selectedFile, setSelectedFile] = useState<File | null>(null);
    const [isLoading, setIsLoading] = useState(false);

    const bottomRef = useRef<HTMLDivElement | null>(null);
    const textareaRef = useRef<HTMLTextAreaElement | null>(null);

    const adjustTextareaHeight = () => {
        const textarea = textareaRef.current;
        if (textarea) {
            textarea.style.height = "40px";
            const maxHeight = 100;
            textarea.style.height = Math.min(textarea.scrollHeight, maxHeight) + "px";
        }
    };

    useEffect(() => {
        adjustTextareaHeight();
    }, [input]);

    const scrollToBottom = () => {
        const el = bottomRef.current;
        if (el) {
            el.scrollIntoView({ behavior: 'smooth' });
        }
    };

    async function sendChatRequest(input: string): Promise<ChatApiResponse> {
        const response = await fetch('https://nt61npvbxb.execute-api.us-east-2.amazonaws.com/Dev/process_test', {
          method: 'POST',
          headers: {
            'Content-Type': 'text/plain',
          },
          body: JSON.stringify({
            type: 'question',
            question: input,
          }),
        });
      
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      
        const data: ChatApiResponse = await response.json();
        return data;
    }

    // async function sendFileQuestionRequest(
    //     input: string, 
    //     filename: string, 
    //     fileContent: string, 
    // ): Promise<ChatApiResponse> {
    //     const response = await fetch('https://nt61npvbxb.execute-api.us-east-2.amazonaws.com/Dev/process_test', {
    //       method: 'POST',
    //       headers: {
    //         'Content-Type': 'text/plain',
    //       },
    //       body: JSON.stringify({
    //         type: 'file+question',
    //         filename: filename,
    //         file_content: fileContent,
    //         question: input,
    //         worker_name: 'stepfunction2',
    //       }),
    //     });
      
    //     if (!response.ok) {
    //       throw new Error(`HTTP error! status: ${response.status}`);
    //     }
      
    //     const data: ChatApiResponse = await response.json();
    //     return data;
    // }

    async function sendFileQuestionRequest(
        input: string, 
        filename: string, 
        fileContent: string, 
    ): Promise<ChatApiResponse> {
        const response = await fetch('https://nt61npvbxb.execute-api.us-east-2.amazonaws.com/Dev/process_test', {
          method: 'POST',
          headers: {
            'Content-Type': 'text/plain',
          },
          body: JSON.stringify({
            type: 'file+question',
            filename: filename,
            file_content: fileContent,
            question: input,
            worker_name: 'stepfunction2',
          }),
        });
      
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
      
        const data = await response.json();
        const xml = parseXmlfromString(data.outputXml)

        console.log(xml);

        const serializer = new XMLSerializer();
        const xmlText = serializer.serializeToString(xml!);

        console.log(xmlText);
        localStorage.setItem('drawio-diagram', xmlText)
        

        return data;
    }

    function parseXmlfromString(xml: string): Document | null {
        try {
          const parser = new DOMParser();
          const doc = parser.parseFromString(xml, "application/xml");
      
          // Check for parsing errors
          const parserError = doc.getElementsByTagName("parsererror");
          if (parserError.length > 0) {
            console.error("XML parsing error:", parserError[0].textContent);
            return null;
          }
      
          return doc;
        } catch (err) {
          console.error("Failed to parse XML string:", err);
          return null;
        }
      }

    const convertFileToBase64 = (file: File): Promise<string> => {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                if (typeof reader.result === 'string') {
                    const base64Content = reader.result.split(',')[1];
                    resolve(base64Content);
                } else {
                    reject(new Error('Failed to read file'));
                }
            };
            reader.onerror = (error) => reject(error);
        });
    };

    const handleSend = async () => {
        if (!input.trim() && !selectedFile) return;

        const userMessage: Message = { 
            sender: USER, 
            text: input,
            fileName: selectedFile?.name
        };
        setMessages(prev => [...prev, userMessage]);

        const tempInput = input;
        const tempFile = selectedFile;
        setInput('');
        setSelectedFile(null);

        try {
            setIsLoading(true);
            let data: ChatApiResponse;
            
            if (tempFile === null) {
                data = await sendChatRequest(tempInput);
            } else {
                const fileContent = await convertFileToBase64(tempFile);
                data = await sendFileQuestionRequest(
                    tempInput,
                    tempFile.name,
                    fileContent,
                );
            }

            // data = {
            //     type: 'question',
            //     session_id: '',
            //     answer: 'No response received.',
            //     outputXml: XMLResponse
            // }
            
            const botMessage: Message = {
                sender: BOT,
                text: data.answer ?? '' ,
                xmlOutput: data.outputXml || ''
            };

            setMessages(prev => [...prev, botMessage]);
        } catch (err: unknown) {
            console.error(err);
            const botMessage: Message = {
                sender: BOT,
                text: `Sorry, I couldn't process your message. Please try again.`
            };
            setMessages(prev => [...prev, botMessage]);
        } finally {
            setIsLoading(false);
        }
    };

    const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
        setInput(e.target.value);
    };

    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
        const files = e.target.files;
        if (files?.length) {
            setSelectedFile(files[0]);
        }
    };

    const removeFile = () => {
        setSelectedFile(null);
    };

    const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            handleSend();
        }
    };

    useEffect(() => {
        scrollToBottom();
    }, [messages]);

    return (
        <div className="flex flex-col h-[calc(100vh-3rem)] bg-white">
            <main className="flex-1 overflow-y-auto px-4 py-6 bg-white">
                <div className="mx-auto max-w-4xl space-y-4">
                    {messages.map((msg, idx) => (
                        <div
                            key={idx}
                            className={`chat ${msg.sender === USER ? 'chat-end' : 'chat-start'}`}
                        >
                            <div
                                className={`max-w-full px-4 py-3 whitespace-pre-wrap rounded-2xl shadow-md transition-all select-text ${
                                    msg.sender === USER
                                        ? 'bg-black text-white'
                                        : 'bg-gray-100 text-black border border-gray-200'
                                }
                                ${msg.xmlOutput ? 'w-screen' : ''}
                                `}
                                style={{maxWidth: '600px'}}
                            >
                                {msg.fileName && (
                                    <div className="mb-2 flex items-center gap-2">
                                        <FiPaperclip size={16} className="opacity-70" />
                                        <span className="text-sm opacity-70 font-medium">{msg.fileName}</span>
                                    </div>
                                )}

                                {msg.text && (
                                    <div className={msg.xmlOutput ? 'mb-4' : ''}>
                                        {msg.text}
                                    </div>
                                )}

                                {msg.xmlOutput && (
                                    <div className="w-full">
                                        <DrawioChart xml={msg.xmlOutput} />
                                    </div>
                                )}
                            </div>
                        </div>
                    ))}

                    {isLoading && (
                        <div className="chat chat-start">
                            <div className="max-w-full px-4 py-3 rounded-2xl shadow-md bg-gray-100 text-black border border-gray-200 flex items-center space-x-3">
                                <span className="loading loading-dots loading-sm"></span>
                                <span className="text-gray-600">Oecora is thinking...</span>
                            </div>
                        </div>
                    )}

                    <div ref={bottomRef}/>
                </div>
            </main>

            <footer className="p-4 bg-white border-t border-gray-200">
                <div className="max-w-4xl mx-auto w-full bg-white border relative border-gray-200 rounded-2xl px-4 py-3 shadow-sm transition flex flex-col gap-2">
                    <textarea
                        ref={textareaRef}
                        placeholder="Message Oecora..."
                        className="w-full bg-transparent outline-none text-black placeholder-gray-500 px-2 resize-none overflow-y-auto focus:ring-0"
                        style={{minHeight: '40px', maxHeight: '100px'}}
                        value={input}
                        onChange={handleInputChange}
                        onKeyDown={handleKeyDown}
                        rows={1}
                    />

                    <div className="flex justify-between items-center">
                        <div className="flex items-center space-x-2">
                            <label className="flex items-center text-gray-500 hover:text-black p-1.5 rounded-full transition space-x-1 cursor-pointer">
                                <FiPaperclip size={20}/>
                                <span className="select-none">Attach</span>
                                <input
                                    type="file"
                                    multiple
                                    onChange={handleFileChange}
                                    className="hidden"
                                    accept="*/*"
                                    />
                            </label>

                            {selectedFile !== null ? (
                            <div className="flex bg-gray-800 rounded-lg py-1.5 px-2.5 border gap-1 border-gray-700 max-w-xs">
                                <p className="text-sm font-medium truncate" title={selectedFile.name}>
                                    {selectedFile.name}
                                </p>
                                
                                <button
                                    onClick={removeFile}
                                    className="text-gray-300 hover:text-gray-100 transition-colors"
                                    title="Remove file"
                                >
                                    <HiX className="w-4 h-4" />
                                </button>
                            </div>
                        ) : null }

                        </div>

                        <button
                            onClick={handleSend}
                            className="p-2 rounded-full bg-black hover:bg-gray-800 text-white transition disabled:opacity-50"
                            disabled={isLoading}
                            type="button"
                        >
                            <IoSend size={18}/>
                        </button>
                    </div>
                </div>
            </footer>
        </div>
    );
};

const navigationItems = [
    {
        path: '/',
        name: 'Home',
        icon: <HiHome className="h-5 w-5" />
    },
    {
        path: '/chat',
        name: 'Chat',
        icon: <HiChatAlt2 className="h-5 w-5" />
    },
    {
        path: '/canvas',
        name: 'Canvas',
        icon: <HiColorSwatch className="h-5 w-5" />
    }
];

// Layout component
const Layout = ({ children }: { children: React.ReactNode }) => {
    const location = useLocation();

    return (
        <div className="drawer lg:drawer-open bg-white">
            <input id="my-drawer-2" type="checkbox" className="drawer-toggle" />
            
            <div className="drawer-content flex flex-col bg-white">
                <div className="navbar bg-white border-b border-gray-200 lg:hidden">
                    <div className="flex-none">
                        <label htmlFor="my-drawer-2" className="btn btn-square btn-ghost text-black hover:bg-gray-100">
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                fill="none"
                                viewBox="0 0 24 24"
                                className="inline-block w-6 h-6 stroke-current"
                            >
                                <path
                                    strokeLinecap="round"
                                    strokeLinejoin="round"
                                    strokeWidth="2"
                                    d="M4 6h16M4 12h16M4 18h16"
                                ></path>
                            </svg>
                        </label>
                    </div>
                    <div className="flex-1">
                        <h1 className="text-xl font-semibold text-black">Oecora</h1>
                    </div>
                </div>

                <main className="flex-1 p-6 bg-white min-h-screen">
                    <div className="mx-auto">
                        {children}
                    </div>
                </main>
            </div>

            <div className="drawer-side">
                <label htmlFor="my-drawer-2" aria-label="close sidebar" className="drawer-overlay"></label>
                <aside className="min-h-full bg-white border-r-2 border-gray-200 text-black">
                    <div className="p-4 border-b border-gray-200 bg-white">
                        <h2 className="text-lg font-semibold text-black text-center">O</h2>
                    </div>
                    
                    <ul className="menu p-2 space-y-2 bg-white border-gray-200 w-16">
                        {navigationItems.map((item) => (
                            <li key={item.path}>
                                <Link 
                                    to={item.path} 
                                    className={`flex items-center justify-center w-12 h-12 rounded-lg ${
                                        location.pathname === item.path 
                                            ? 'bg-black text-white hover:bg-gray-800' 
                                            : 'text-black hover:bg-gray-100'
                                    }`}
                                    title={item.name}
                                >
                                    {item.icon}
                                </Link>
                            </li>
                        ))}
                    </ul>
                </aside>
            </div>
        </div>
    );
};


function App() {
    return (
        <div className="bg-white min-h-screen">
            {/* basename is used to make the app work on GitHub Pages */}
            <Router basename="/oecora">
                <Layout>
                    <Routes>
                        <Route path="/" element={<Home />} />
                        <Route path="/chat" element={<Chat />} />
                        <Route path="/canvas" element={<Canva />} />
                    </Routes>
                </Layout>
            </Router>
        </div>
    );
}

export default App;